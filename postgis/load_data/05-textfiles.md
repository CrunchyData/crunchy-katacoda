There are many GIS file formats out there, but sometimes you may also get 
spatial data in a plain text file. If you're already familiar with the `\copy` 
command in `psql`, you can definitely also use it to load spatial data when 
appropriate.

In this environment, we have a `cities15000.txt` file from the [Geonames database](https://download.geonames.org/export/dump/).
 This file contains cities with a population > 15000 or capitals (ca 25.000), 
 and has columns for `longitude` and `latitude`.

For this exercise, we'll create a new table with a calculated geometry column. 
(This feature is also referred to as [Generated Columns](https://www.postgresql.org/docs/current/ddl-generated-columns.html)
 and is only available for Postgres version 12+.) When we import the data into 
 this table, the geometry column will automatically
 be populated with values based on a calculation we specify.

### 1. Create new table with calculated column

Execute the following statement to create our `cities` table:

```
CREATE TABLE cities (
    id INT GENERATED BY DEFAULT AS IDENTITY,
    geonameid INT,
    name VARCHAR(200) NOT NULL,
    asciiname VARCHAR(200),
    alternatenames TEXT,
    latitude NUMERIC,
    longitude NUMERIC,
    feature_class CHAR(1),
    feature_code VARCHAR(10),
    country_code CHAR(2),
    cc2 TEXT,
    admin1_code VARCHAR(20),
    admin2_code VARCHAR(80),
    admin3_code VARCHAR(20),
    admin4_code VARCHAR(20),
    population BIGINT,
    elevation INT,
    dem INT,
    timezone VARCHAR(40),
    modification_date DATE,
    geom geometry(Point,4326) GENERATED ALWAYS AS (ST_SetSRID(ST_MakePoint(longitude, latitude), 4326)) STORED
);
```{{execute}}

The main things to note here are:
1. We create an `id` column for our table. `id` is another type of "generated"
 column but it's distinct from the "calculated column" we create later. The cities data has its own 
`geonameid` column, but we want the individual records in Postgres to also have
 their own table ID value.
2. We define our geometry column `geom` to contain Point geometries and set the
SRID to 4326.
3. We use the `GENERATED ALWAYS AS` clause to tell Postgres how the values in 
this column are to be calculated. (The `STORED` keyword is also required.)
4. We take the values from the `longitude` and `latitude` columns and:  
  a. Call [ST_MakePoint](https://postgis.net/docs/ST_MakePoint.html) to create the Point geometry,  
  b. Set SRID 4326 on the generated geometry using [ST_SetSRID](https://postgis.net/docs/ST_SetSRID.html). 

>***Note:***
If you've completed the [Geography](https://learn.crunchydata.com/postgis/geography/) 
course in this series, you may be wondering if we should be using the Geography
 type instead for this table, since the data meets the criteria of "geographically 
 dispersed." It depends on how you intend to use this data and what types of 
 queries you want to run. We're keeping it simple and sticking to Geometry for
  our purposes, but using Geography here would make sense too.

We'll now use the `\copy` command to populate `cities`:

```
\copy cities (geonameid, name, asciiname, alternatenames, latitude, longitude, feature_class, feature_code, country_code, cc2, admin1_code, admin2_code, admin3_code, admin4_code, population, elevation, dem, timezone, modification_date) from '/data/cities15000.txt' with (format csv, delimiter E'\t', header false)
```{{execute}}

- Our data file does not have the `id` and `geom` values, so we're not 
including them in the list of columns in `cities (...)`.
- We also use these options in `WITH`:
  - `format csv` - while the file has a .txt extension, `csv` is actually still
   used if the file is "separated" or delimited. In this case, we have a 
   tab-delimited file.
  - `delimiter E'\t'` - we use an [escape string constant](https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-CONSTANTS)
   to indicate the tab delimiter.
  - `header false` is used with the `csv` format and indicates that our file 
  does not contain a header row.

Try running some simple queries against `cities`, such as:

```
\x

SELECT * FROM cities ORDER BY population DESC LIMIT 3;
```{{execute}}

### Good ol' INSERT statements

You can also add spatial data in PostGIS using SQL inserts. If you haven't yet,
 check out our course on [INSERT](https://learn.crunchydata.com/postgresql-devel/courses/basics/insert).
The [official PostGIS docs](https://postgis.net/docs/using_postgis_dbmanagement.html#idm2274) 
has an example on how to use the INSERT syntax to add geometry/geography values
 in their text representation.
